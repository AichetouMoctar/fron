<div class="dashboard-wrapper">
  <aside class="sidebar">
    <div class="sidebar-header">
      <i class="fas fa-bus-alt"></i>
      <span>WIJHA PRO</span>
    </div>

    <div class="sidebar-content">
      <div class="nav-section">
        <p class="section-label">Géolocalisation</p>
        <button class="gps-button" (click)="findNearbyStops()" [disabled]="isSearchingNearby">
          <i class="fas fa-crosshairs" [class.fa-spin]="isSearchingNearby"></i>
          {{ isSearchingNearby ? 'Recherche...' : 'Autour de moi' }}
        </button>
      </div>

      <div class="nav-section">
        <p class="section-label">Réseau de Transport</p>
        <div class="ligne-list">
          <div *ngFor="let l of lignes" 
               (click)="onSelectLigne(l)"
               [class.active]="selectedLigne?.id === l.id"
               class="ligne-item">
            <div class="ligne-badge">{{ l.numero || 'L' }}</div>
            <div class="ligne-name text-truncate">{{ l.nom }}</div>
            <i class="fas fa-chevron-right arrow"></i>
          </div>
        </div>
      </div>
    </div>
  </aside>

  <main class="main-panel">
    <div *ngIf="selectedLigne; else emptyState" class="fade-in">
      
      <header class="detail-header shadow-sm">
        <div class="header-info">
          <h1>Ligne {{ selectedLigne.numero }} : {{ selectedLigne.nom }}</h1>
          <span class="status-pill">En service</span>
        </div>
      </header>

      <div class="details-container">
        <section class="glass-card itinerary">
          <h3><i class="fas fa-route"></i> Itinéraire complet</h3>
          <div class="custom-timeline">
            <div *ngFor="let a of arrets" class="timeline-node" (click)="onSelectStop(a.arretId)">
              <div class="node-marker"></div>
              <div class="node-card">
                <span class="order">{{ a.ordre }}</span>
                <span class="name">{{ a.arretNom }}</span>
              </div>
            </div>
          </div>
        </section>

        <div class="info-sidebar">
          <section class="glass-card schedule">
            <h3><i class="fas fa-clock"></i> Horaires</h3>
            <div class="time-grid">
              <div *ngFor="let h of horaires" class="time-tag">{{ h.heureDepart }}</div>
            </div>
            <div *ngIf="horaires.length === 0" class="no-data small">Aucun horaire programmé</div>
          </section>

          <section class="glass-card stop-info" *ngIf="selectedStopDetails">
            <h3><i class="fas fa-info-circle"></i> Station : {{ selectedStopDetails.nom }}</h3>
            <div class="coord-row">
              <div class="coord"><span>Lat:</span> {{ selectedStopDetails.latitude }}</div>
              <div class="coord"><span>Lon:</span> {{ selectedStopDetails.longitude }}</div>
            </div>
          </section>
        </div>
      </div>
    </div>

    <ng-template #emptyState>
      <div class="empty-screen">
        <div class="empty-icon"><i class="fas fa-map-marked-alt"></i></div>
        <h2>Système de Consultation Wijha</h2>
        <p>Sélectionnez une ligne dans le menu de gauche pour visualiser les détails en temps réel.</p>
      </div>
    </ng-template>
  </main>
</div>
